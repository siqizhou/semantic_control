<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Semantic Control</title>
  <meta name="description" content="Semantic Control Website." />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>⚪️</text></svg>">

  <!-- Font: Roboto Slab -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@200;300;400;500;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg: #0e0f12;
      --text: #ffffff;
      --muted: #b7c0cc;
      --brand: #cbe9f9;   /* light blue */
      --brand-2: #a7ffb7;
      --card: #151821;
      --border: #232736;
      --maxw: 1024px;

      /* Animation speed controls */
      --draw-duration: 9000ms;  /* slow overall draw (9s) */
      --draw-stagger: 160ms;     /* delay between each stroke */
    }

    @media (prefers-color-scheme: light){
      :root{
        --bg: #ffffff;
        --text: #0d1017;
        --muted: #3b4756;
        --brand: #87d6ff;   /* keep light blue in light mode as well */
        --brand-2: #00a86b;
        --card: #f4f7fb;
        --border: #e6ebf2;
      }
    }

    *,*::before,*::after{ box-sizing: border-box; }
    html{ scroll-behavior: smooth; }

    body{
      margin: 0; 
      --chosen-font: 'Roboto Slab';
      font: 200 16px/1.6 var(--chosen-font), serif;
      color: var(--text); 
      background: var(--bg);
    }

    img{ max-width: 100%; display: block; }
    a{ color: inherit; text-decoration: none; }
    p{ margin: 0 0 1rem; color: var(--muted); font-weight: 300; }

    h1,h2,h3{ margin: 0 0 .6rem; line-height: 1.25; font-family: var(--chosen-font), serif; font-weight: 300; }

    .wrap{ max-width: var(--maxw); margin: 0 auto; padding: 0 1rem; }

    .site-header{
      position: sticky; top: 0; z-index: 10; backdrop-filter: saturate(180%) blur(8px);
      background: color-mix(in oklab, var(--bg) 80%, transparent);
      border-bottom: 1px solid var(--border);
    }
    .nav{ display: flex; align-items: center; justify-content: space-between; padding: .75rem 0; }
    .brand{ font-weight: 200; letter-spacing: .5px; font-family: var(--chosen-font), serif; }
    .brand .dot{ color: var(--brand); }
    .links{ display: flex; gap: 1rem; font-family: var(--chosen-font), serif; font-weight: 200; }
    .links a{ opacity: .9; }
    .links a:hover{ color: var(--brand); }

    .hero{ padding: 0 0 2.5rem; position: relative; }
    .banner{
      width: 100%;
      aspect-ratio: 3 / 2;
      overflow: hidden;
      position: relative;
      background: #ffffff;
    }
     /* Base image fills banner */
     .banner .banner-img{
       position: absolute;
       inset: 0;
       width: 100%;
       height: 100%;
       object-fit: cover;
       z-index: 1;
     }
     /* Animated SVG overlay */
     .banner svg{
       position: absolute;
       inset: 0;
       width: 100%;
       height: 100%;
       display: block;
       z-index: 2;
       pointer-events: none; /* allow clicks to pass through */
     }
     /* Gradient sits above SVG but below text */
     .banner::after {
       content: "";
       position: absolute;
       left: 0;
       right: 0;
       bottom: 0;
       height: 50%;
       background: linear-gradient(to top, rgba(255,255,255,0.99), rgba(255,255,255,0));
       pointer-events: none;
       z-index: 5;
     }

     .banner .overlay-text {
      position: absolute;
      bottom: 25%;
      left: 0;
      color: #0e0e0e;
      font-size: clamp(1.5rem, 4vw, 2.8rem);
      font-weight: 300;
      text-align: left;
      font-family: var(--chosen-font), serif;
      letter-spacing: .5px;
      z-index: 6;
      padding: 0 1rem;
      line-height: 1.1;
    }

    .banner .overlay-subtitle {
      position: absolute;
      bottom: calc(25% - clamp(0.75rem, 2vw, 1.1rem) * 1.2 - 0.1rem);
      left: 0;
      color: #0e0e0e;
      font-size: clamp(0.75rem, 2vw, 1.1rem);
      font-weight: 200;
      text-align: left;
      font-family: var(--chosen-font), serif;
      z-index: 6;
      margin: 0;
      padding: 0 1rem;
      line-height: 1.2;
    }

    .intro{ padding: 1.5rem 0 0.5rem; text-align: center; }
    .intro .subtitle{ font-size: 1rem; font-style: italic; font-weight: 200; }

    .paper-card{ background: #f5f5f5; padding: 1rem; display: flex; flex-direction: column; gap: .5rem; font-weight: 300; }
    .paper-card h3{ font-weight: 400; }
    .paper-card .figure-placeholder{ width: 100%; aspect-ratio: 1/1; background: #e8e8e8; display: flex; align-items: center; justify-content: center; color: #888888; font-size: .9rem; font-style: italic; margin-bottom: .5rem; flex-shrink: 0; }

    .tags{ display: flex; flex-wrap: wrap; gap: .4rem; }
    .tag{ font-size: .8rem; padding: .2rem .5rem; border: 1px solid var(--border); border-radius: 999px; color: var(--muted); }
    .links-row{ display: flex; gap: .8rem; flex-wrap: wrap; }
    
    .abstract-toggle{ 
      background: var(--brand); 
      color: var(--bg); 
      border: none; 
      padding: .4rem .8rem; 
      border-radius: 4px; 
      font-size: .8rem; 
      cursor: pointer; 
      margin-top: .5rem;
      font-family: var(--chosen-font), serif;
    }
    .abstract-toggle:hover{ opacity: 0.8; }
    .abstract{ 
      margin-top: .5rem; 
      font-size: .85rem; 
      line-height: 1.4; 
      color: var(--muted);
    }

    section{ padding: 2.5rem 0; }
    
    .tag-filter{
      padding: 1.5rem 0;
      border-bottom: 1px solid var(--border);
      margin-bottom: 2rem;
    }
    
    .tag-filter-container{
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      justify-content: center;
      align-items: center;
    }
    
    .tag-filter-btn{
      background: var(--card);
      border: 1px solid var(--border);
      color: var(--text);
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-size: 0.85rem;
      font-family: var(--chosen-font), serif;
      cursor: pointer;
      transition: all 0.2s ease;
      white-space: nowrap;
    }
    
    .tag-filter-btn:hover{
      background: var(--brand);
      color: var(--bg);
      border-color: var(--brand);
    }
    
    .tag-filter-btn.active{
      background: var(--brand);
      color: var(--bg);
      border-color: var(--brand);
    }
    
    .grid{
      display: flex;
      gap: 1.2rem;
      justify-content: center;
      align-items: flex-start;
      flex-wrap: wrap;
    }
    
    .grid-column{
      display: flex;
      flex-direction: column;
      gap: 1.2rem;
      width: 280px;
      flex-shrink: 0;
    }
    
    /* Responsive column adjustments */
    @media (max-width: 920px) {
      .grid {
        flex-direction: column;
        align-items: center;
      }
      .grid-column {
        width: 100%;
        max-width: 400px;
      }
    }
    
    @media (min-width: 921px) and (max-width: 1200px) {
      .grid-column {
        width: 280px;
      }
    }
    
    .grid .paper-card{
      width: 100%;
    }
    .paper-card {
      min-height: 0;
    }

    .site-footer{ padding: 2.5rem 0; border-top: 1px solid var(--border); color: var(--muted); font-size: .9rem; font-style: italic; font-family: var(--chosen-font), serif; }
    .site-footer a{ color: var(--brand); }

    /* Thumbnail rule */
    .paper-card .thumb{
      width: 100%;
      aspect-ratio: 1/1;
      object-fit: cover;
      background: #fefefe;
      margin-bottom: .5rem;
      display: block;
      flex-shrink: 0;
    }

    /* --- Line-art draw animation (banner.svg) --- */

    /* Animate ALL stroke-capable elements */
    .draw .svg-draw-stroke{
      stroke: var(--brand);
      stroke-width: 1.0;
      fill: none;
      stroke-linecap: round;
      stroke-linejoin: round;

      /* length normalization */
      stroke-dasharray: 1;
      stroke-dashoffset: 1;

      animation: banner-draw var(--draw-duration) cubic-bezier(.33,0,.17,1) forwards;
      animation-play-state: paused;
      will-change: stroke-dashoffset;
    }
    .draw.inview .svg-draw-stroke { animation-play-state: running; }

    @keyframes banner-draw { to { stroke-dashoffset: 0; } }

    @media (prefers-reduced-motion: reduce){
      .draw .svg-draw-stroke{ animation: none; stroke-dashoffset: 0; }
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="wrap nav">
      <a href="index.html" class="brand">Semantic Control<span class="dot">.</span></a>
      <nav class="links" aria-label="Primary">
        <a href="index.html">Home</a>
        <!-- <a href="related-work/index.html">Related Work</a> -->
        <a href="people/index.html">Contributors</a>
      </nav>
    </div>
  </header>

  <main id="home" class="wrap">
    <section class="hero" aria-label="Site banner">
      <div class="banner" role="img" aria-label="Line art banner">
        <!-- Base image -->
        <img class="banner-img" src="assets/images/banner.jpg" alt="Semantic Control Banner">

        <!-- SVG injected by JS (traces over image) -->
        <div class="overlay-text">semantic control</div>
        <div class="overlay-subtitle">perceive and act through robots' lenses</div>
      </div>
      <div class="intro"></div>
    </section>

    <section id="papers" aria-label="Papers">
      <div class="tag-filter">
        <div class="tag-filter-container">
          <button class="tag-filter-btn active" data-tag="all">All</button>
        </div>
      </div>
      <div id="papers-grid" class="grid" role="list"></div>
      <template id="paper-card-template">
        <article class="paper-card" role="listitem">
          <img class="thumb" alt="">
          <h3 class="title"></h3>
          <p class="meta"></p>
          <div class="tags"></div>
          <p class="links-row"></p>
          <button class="abstract-toggle" style="display: none;">Show Abstract</button>
          <div class="abstract" style="display: none;"></div>
        </article>
      </template>
    </section>
  </main>

  <footer class="site-footer">
    <div class="wrap">
      <p>© <span id="year"></span> Semantic Control. The projects are supported by the European Union’s Horizon Europe research and innovation programme under the Marie Skłodowska-Curie grant agreement No. 101155035, by the <a href="https://www.robotics-institute-germany.de/">Robotics Institute Germany</a> under BMBF grant 16ME0997K, and by the Humboldt Professorship for Robotics and Artificial Intelligence.</p>
    </div>
  </footer>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>

  <script>
  (async function loadPapers(){
    const grid = document.getElementById('papers-grid');
    const tpl  = document.getElementById('paper-card-template');

    function addLinks(container, entries){
      const items = Object.entries(entries).filter(([,url]) => url && url !== '' && url !== '#');
      items.forEach(([label, url], i) => {
        const a = document.createElement('a');
        a.href = url;
        a.textContent = label;
        a.target = "_blank";
        a.rel = "noopener";
        container.appendChild(a);
        if (i < items.length - 1) container.append(" · ");
      });
    }

    function filterPapers(selectedTag, projects, columns, allCards) {
      // Clear all columns
      columns.forEach(column => column.innerHTML = '');
      
      // Filter projects based on selected tag
      const filteredProjects = selectedTag === 'all' 
        ? projects 
        : projects.filter(p => p.tags && p.tags.includes(selectedTag));
      
      // Re-distribute filtered projects to columns
      filteredProjects.forEach((p, i) => {
        const columnIndex = i % columns.length;
        const card = allCards[p._file];
        if (card) {
          columns[columnIndex].appendChild(card);
        }
      });
    }

    async function loadOne(filename){
      const res = await fetch(`projects/${filename}`);
      if (!res.ok) throw new Error(`Failed to load ${filename}`);
      const data = await res.json();
      data._file = filename;
      return data;
    }

    try{
      const manifestRes = await fetch('projects/manifest.json');
      if (!manifestRes.ok) throw new Error('Failed to load projects/manifest.json');
      const files = await manifestRes.json();

      const projects = await Promise.all(files.map(loadOne));

      projects.sort((a, b) => {
        // First sort by order (if specified)
        if ((b.order || 0) !== (a.order || 0)) {
          return (b.order || 0) - (a.order || 0);
        }
        
        // Then sort by venue type with preferred order
        const getVenuePriority = (venue) => {
          if (!venue) return 999; // Unknown venues last
          const venueLower = venue.toLowerCase();
          
          // Define preferred venue order (lower number = higher priority)
          const venuePriorities = {
            // Top-tier journals
            'ijrr': 1,
            't-ro': 2,
            'ra-l': 3,
            'tac': 4,
            'automatica': 5,
            'ieee transactions': 6,
            'journal': 7,
            
            // Top-tier conferences
            'rss': 10,
            'icra': 11,
            'iros': 12,
            'corl': 13,
            'conference': 14,
            'symposium': 15,
            
            // Preprints
            'preprint': 20,
            'arxiv': 21,
            
            // Other venues
            'venue': 30
          };
          
          // Check for exact matches first
          for (const [key, priority] of Object.entries(venuePriorities)) {
            if (venueLower.includes(key)) {
              return priority;
            }
          }
          
          return 999; // Unknown venues last
        };
        
        const venuePriorityA = getVenuePriority(a.venue);
        const venuePriorityB = getVenuePriority(b.venue);
        if (venuePriorityA !== venuePriorityB) {
          return venuePriorityA - venuePriorityB;
        }
        
        // Then sort by year (newest first)
        if ((b.year || 0) !== (a.year || 0)) {
          return (b.year || 0) - (a.year || 0);
        }
        
        // Finally sort by title alphabetically
        return String(a.title).localeCompare(String(b.title));
      });

      // Collect all unique tags
      const allTags = new Set();
      projects.forEach(p => {
        if (p.tags && Array.isArray(p.tags)) {
          p.tags.forEach(tag => allTags.add(tag));
        }
      });

      // Create tag filter buttons
      const tagFilterContainer = document.querySelector('.tag-filter-container');
      const sortedTags = Array.from(allTags).sort();
      
      sortedTags.forEach(tag => {
        const button = document.createElement('button');
        button.className = 'tag-filter-btn';
        button.setAttribute('data-tag', tag);
        button.textContent = tag;
        tagFilterContainer.appendChild(button);
      });

      // Create columns based on screen width
      function getNumColumns() {
        const screenWidth = window.innerWidth;
        if (screenWidth <= 920) return 1;      // Mobile: single column
        if (screenWidth <= 1200) return 2;     // Tablet: two columns
        return 3;                              // Desktop: three columns
      }
      
      const numColumns = getNumColumns();
      const columns = [];
      for (let i = 0; i < numColumns; i++) {
        const column = document.createElement('div');
        column.className = 'grid-column';
        grid.appendChild(column);
        columns.push(column);
      }

      // Store all cards for filtering
      const allCards = {};
      
      for (let i = 0; i < projects.length; i++){
        const p = projects[i];
        const node = tpl.content.cloneNode(true);
        const card = node.querySelector('.paper-card');
        
        // Add project ID for filtering
        card.setAttribute('data-project-id', p._file);
        
        // Store card for filtering
        allCards[p._file] = card;

        // Thumbnail or placeholder
        const img = node.querySelector('.thumb');
        if (p.thumb){
          img.src = p.thumb;
          img.alt = `${p.title} figure`;
        } else {
          img.replaceWith(Object.assign(document.createElement('div'), {
            className: 'figure-placeholder',
            textContent: 'Figure Placeholder'
          }));
        }

        // Title
        node.querySelector('.title').textContent = p.title || 'Untitled';

        // Meta
        const yy = p.year ? String(p.year).slice(-2) : '';
        const authors = Array.isArray(p.authors) ? p.authors.join(', ') : (p.authors || '');
        node.querySelector('.meta').textContent =
          [p.venue, yy ? `'${yy}` : ''].filter(Boolean).join(' ') +
          (authors ? ` · ${authors}` : '');

        // Tags
        const tagsEl = node.querySelector('.tags');
        (p.tags || []).forEach(tag => {
          const span = document.createElement('span');
          span.className = 'tag';
          span.textContent = tag;
          tagsEl.appendChild(span);
        });

        // Links
        const linksEl = node.querySelector('.links-row');
        const linkEntries = {
          pdf: p.pdf,
          website: p.website,
          code: p.code
        };
        
        // Add DOI if available and not placeholder
        if (p.doi && p.doi !== '#') {
          linkEntries.doi = `https://doi.org/${p.doi}`;
        }
        
        addLinks(linksEl, linkEntries);

        // Abstract toggle
        const abstractToggle = node.querySelector('.abstract-toggle');
        const abstractDiv = node.querySelector('.abstract');
        
        if (p.abstract) {
          abstractToggle.style.display = 'block';
          abstractDiv.textContent = p.abstract;
          
          abstractToggle.addEventListener('click', () => {
            const isVisible = abstractDiv.style.display !== 'none';
            if (isVisible) {
              abstractDiv.style.display = 'none';
              abstractToggle.textContent = 'Show Abstract';
            } else {
              abstractDiv.style.display = 'block';
              abstractToggle.textContent = 'Hide Abstract';
            }
          });
        }

        // Add to appropriate column (round-robin distribution)
        const columnIndex = i % numColumns;
        columns[columnIndex].appendChild(card);
      }

      // Add event listeners to filter buttons (after cards are created)
      const filterButtons = document.querySelectorAll('.tag-filter-btn');
      filterButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          // Remove active class from all buttons
          filterButtons.forEach(b => b.classList.remove('active'));
          // Add active class to clicked button
          btn.classList.add('active');
          
          const selectedTag = btn.getAttribute('data-tag');
          // Get current columns from DOM instead of using stored reference
          const currentColumns = Array.from(grid.querySelectorAll('.grid-column'));
          filterPapers(selectedTag, projects, currentColumns, allCards);
        });
      });

      // Handle window resize to adjust columns
      let resizeTimeout;
      window.addEventListener('resize', () => {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(() => {
          const newNumColumns = getNumColumns();
          const currentColumns = grid.querySelectorAll('.grid-column');
          
          if (newNumColumns !== currentColumns.length) {
            // Clear existing columns
            grid.innerHTML = '';
            
            // Create new columns
            const newColumns = [];
            for (let i = 0; i < newNumColumns; i++) {
              const column = document.createElement('div');
              column.className = 'grid-column';
              grid.appendChild(column);
              newColumns.push(column);
            }
            
            // Re-distribute all cards to new columns
            const activeButton = document.querySelector('.tag-filter-btn.active');
            const selectedTag = activeButton ? activeButton.getAttribute('data-tag') : 'all';
            filterPapers(selectedTag, projects, newColumns, allCards);
          }
        }, 250); // Debounce resize events
      });
    } catch(err){
      console.error(err);
      grid.insertAdjacentHTML('beforebegin',
        `<p class="intro">Could not load projects. Please check <code>projects/manifest.json</code> and JSON files.</p>`
      );
    }
  })();
  </script>

  <!-- Inject and animate banner.svg OVER the JPEG -->
  <script>
  (async function injectBannerSVG(){
    const banner = document.querySelector('.banner');
    if (!banner) return;

    try{
      const res = await fetch('assets/images/banner.svg');
      if (!res.ok) throw new Error('Failed to load assets/images/banner.svg');

      const svgText = await res.text();
      const wrap = document.createElement('div');
      wrap.innerHTML = svgText.trim();

      const svg = wrap.querySelector('svg');
      if (!svg) throw new Error('No <svg> root in banner.svg');

      svg.classList.add('draw');
      svg.setAttribute('role','img');
      svg.setAttribute('aria-label','Decorative line art');

       // Ensure overlay positioning/z-index are correct
       svg.style.position = 'absolute';
       svg.style.inset = '0';
       svg.style.zIndex = '2';
       svg.style.pointerEvents = 'none';

      // Select ALL stroke-capable elements
      const allStrokes = svg.querySelectorAll('path, line, polyline, rect, circle, ellipse, polygon');
      
      // Filter out elements with data-no-anim
      const availableStrokes = Array.from(allStrokes).filter(el => !el.hasAttribute('data-no-anim'));
      
      // Randomly select 30% of available strokes
      const totalStrokes = availableStrokes.length;
      const targetCount = Math.floor(totalStrokes * 0.30);
      const selectedStrokes = availableStrokes
        .sort(() => Math.random() - 0.5) // Shuffle array
        .slice(0, targetCount); // Take first 80%

      console.log(`Total strokes: ${totalStrokes}, Selected for animation: ${targetCount}`);

      // Read CSS var for stagger (fallback 160ms)
      const raw = getComputedStyle(document.documentElement)
        .getPropertyValue('--draw-stagger').trim() || '160ms';
      const step = parseFloat(raw) || 160;
      const unit = raw.replace(/[0-9.\s]/g,'') || 'ms';

      selectedStrokes.forEach((el, i) => {
        // Remove inline dash attrs that can override our CSS
        el.removeAttribute('stroke-dasharray');
        el.removeAttribute('stroke-dashoffset');

        // Normalize length to 1 so CSS 0..1 works consistently
        el.setAttribute('pathLength','1');

        // ensure it's styled/animated
        el.classList.add('svg-draw-stroke');

        // Slow cascade; comment out next line to draw all at once
        el.style.animationDelay = (i * step) + unit;
      });

      // Insert SVG above the image but below text (see z-indexes in CSS)
      banner.prepend(svg);

      // Start animation when in view (runs once)
      const io = new IntersectionObserver(entries => {
        entries.forEach(e => {
          if (e.isIntersecting) {
            svg.classList.add('inview');
            io.unobserve(e.target);
          }
        });
      }, { threshold: 0.25 });
      io.observe(svg);

    } catch(err){
      console.error(err);
      // If SVG fails, we still keep the JPEG visible
    }
  })();
  </script>
</body>
</html>
