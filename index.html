<!doctype html>
<html lang="en">
<head>
  <!-- basic elements-->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- canonical URL -->
  <link rel="canonical" href="https://semanticcontrol.com/"/>

  <!-- title and description -->
  <title>Semantic Control for Robotics</title>
  <meta name="description" content="Research on semantic control and safe robot decision-making. Projects include semantic scene understanding, semantic safety reasoning and decision-making, and safe human-robot interaction for autonomous systems." />

  <!-- open graph tags -->
  <meta property="og:title" content="Semantic Control for Robotics" />
  <meta property="og:description" content="Research on semantic control and safe robot decision-making. Projects include semantic scene understanding, semantic safety reasoning and decision-making, and safe human-robot interaction for autonomous systems." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://semanticcontrol.com/" />
  <meta property="og:image" content="https://semanticcontrol.com/assets/images/banner.svg" />
  <meta property="og:site_name" content="Semantic Control for Robotics" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>‚ö™Ô∏è</text></svg>">

  <!-- font: Roboto Slab -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@200;300;400;500;600&display=swap" rel="stylesheet">

  <!-- Set theme early to prevent flash -->
  <script>
    (function() {
      const saved = localStorage.getItem('theme');
      if (saved) {
        document.documentElement.setAttribute('data-theme', saved);
      } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches) {
        document.documentElement.setAttribute('data-theme', 'light');
      }
    })();
  </script>

  <style>
    :root{
      --bg: #1a1a1a;
      --text: #ffffff;
      --muted: #b7c0cc;
      --brand: #cbe9f9;   /* light blue */
      --brand-2: #a7ffb7;
      --card: #262626;
      --border: #3a3a3a;
      --maxw: 100%;
      --banner-stroke: #666666;  /* dark grey for dark mode */

      /* Animation speed controls */
      --draw-duration: 9000ms;  /* slow overall draw (9s) */
      --draw-stagger: 160ms;     /* delay between each stroke */
    }
    
    /* Dark mode (manual override) */
    :root[data-theme="dark"]{
      --bg: #1a1a1a;
      --text: #ffffff;
      --muted: #b7c0cc;
      --brand: #87d6ff;   /* light blue */
      --brand-2: #a7ffb7;
      --card: #262626;
      --border: #3a3a3a;
      --banner-stroke: #666666;  /* dark grey for dark mode */
    }

    /* Light mode (default) */
    :root[data-theme="light"]{
      --bg: #ffffff;
      --text: #0d1017;
      --muted: #3b4756;
      --brand: #87d6ff;   /* keep light blue in light mode as well */
      --brand-2: #00a86b;
      --card: #f4f7fb;
      --border: #e6ebf2;
      --banner-stroke: #d3d3d3;  /* light gray for light mode */
    }
    
    /* Auto-detect system preference */
    @media (prefers-color-scheme: light){
      :root:not([data-theme]){
        --bg: #ffffff;
        --text: #0d1017;
        --muted: #3b4756;
        --brand: #87d6ff;   /* keep light blue in light mode as well */
        --brand-2: #00a86b;
        --card: #f4f7fb;
        --border: #e6ebf2;
        --banner-stroke: #d3d3d3;  /* light gray for light mode */
      }
    }

    /* Dark mode banner - SVG background will use CSS variables */
    :root[data-theme="dark"] .banner {
      background: #1a1a1a;
    }
    
    @media (prefers-color-scheme: dark) {
      :root:not([data-theme="light"]) .banner {
        background: #1a1a1a;
      }
    }
    
    :root[data-theme="dark"] .banner .overlay-text,
    :root[data-theme="dark"] .banner .overlay-subtitle {
      color: #ffffff !important;
    }
    
    @media (prefers-color-scheme: dark) {
      :root:not([data-theme="light"]) .banner .overlay-text,
      :root:not([data-theme="light"]) .banner .overlay-subtitle {
        color: #ffffff !important;
      }
    }
    
    :root[data-theme="dark"] .thumb-container {
      background-color: #1a1a1a !important;
    }
    
    :root[data-theme="dark"] .paper-card .thumb {
      filter: contrast(0) brightness(2) !important;
    }
    
    @media (prefers-color-scheme: dark) {
      :root:not([data-theme="light"]) .thumb-container {
        background-color: #1a1a1a !important;
      }
      
      :root:not([data-theme="light"]) .paper-card .thumb {
        filter: contrast(0) brightness(2) !important;
      }
    }
    
    :root[data-theme="dark"] .paper-card .figure-placeholder {
      background: #171717 !important;
      color: #777777 !important;
      filter: invert(1);
    }
    
    @media (prefers-color-scheme: dark) {
      :root:not([data-theme="light"]) .paper-card .figure-placeholder {
        background: #171717 !important;
        color: #777777 !important;
        filter: invert(1);
      }
    }

    *,*::before,*::after{ box-sizing: border-box; }
    html{ scroll-behavior: smooth; }

    body{
      margin: 0; 
      --chosen-font: 'Roboto Slab';
      font: 200 16px/1.6 var(--chosen-font), serif;
      color: var(--text); 
      background: var(--bg);
    }

    img{ max-width: 100%; display: block; }
    a{ color: inherit; text-decoration: none; }
    p{ margin: 0 0 1rem; color: var(--muted); font-weight: 300; }

    h1,h2,h3{ margin: 0 0 .6rem; line-height: 1.25; font-family: var(--chosen-font), serif; font-weight: 300; }

    .wrap{ max-width: var(--maxw); margin: 0 auto; padding: 0 3%; }

    .site-header{
      position: sticky; top: 0; z-index: 10; backdrop-filter: saturate(180%) blur(8px);
      background: color-mix(in oklab, var(--bg) 80%, transparent);
      border-bottom: 1px solid var(--border);
      padding: 0 3%;
    }
    .nav{ display: flex; align-items: center; justify-content: space-between; padding: .75rem 0; width: 100%; }
    .brand{ font-weight: 200; letter-spacing: .5px; font-family: var(--chosen-font), serif; }
    .brand .dot{ color: var(--brand); }
    .links{ display: flex; gap: 1rem; font-family: var(--chosen-font), serif; font-weight: 200; align-items: center; }
    .links a{ opacity: .9; }
    .links a:hover{ color: var(--brand); }
    
    .theme-toggle{
      background: var(--card);
      border: 1px solid var(--border);
      color: var(--text);
      padding: 0.4rem 0.8rem;
      border-radius: 20px;
      font-size: 0.85rem;
      font-family: var(--chosen-font), serif;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 0.4rem;
      opacity: 0.9;
    }
    .theme-toggle:hover{
      background: var(--brand);
      color: var(--bg);
      border-color: var(--brand);
      opacity: 1;
    }

    .hero{ 
      padding: 0 0 1rem; 
      position: relative; 
    }
    .banner{
      width: 100%;
      aspect-ratio: 3 / 2;
      overflow: hidden;
      position: sticky;
      top: 0;
      z-index: 5;
      background: #ffffff;
      transition: transform 0.3s ease-out;
    }
    
    .banner.scrolled-up {
      transform: translateY(-100%);
    }
     /* Background SVG (static, no animation) */
     .banner .banner-svg-bg{
       position: absolute;
       inset: 0;
       width: 100%;
       height: 100%;
       display: block;
       z-index: 1;
       pointer-events: none;
     }
     /* Animated SVG overlay */
     .banner .banner-svg-animated{
       position: absolute;
       inset: 0;
       width: 100%;
       height: 100%;
       display: block;
       z-index: 2;
       pointer-events: none; /* allow clicks to pass through */
     }
     /* General SVG styling */
     .banner svg{
       position: absolute;
       inset: 0;
       width: 100%;
       height: 100%;
       display: block;
       pointer-events: none;
     }
     /* Gradient sits above SVG but below text */
     .banner::after {
       content: "";
       position: absolute;
       left: 0;
       right: 0;
       bottom: 0;
       height: 50%;
       background: linear-gradient(to top, rgba(255,255,255,0.99), rgba(255,255,255,0));
       pointer-events: none;
       z-index: 5;
     }
     
     /* Dark mode gradient overlay - use banner background color for subtle fade */
     :root[data-theme="dark"] .banner::after {
       background: linear-gradient(to top, rgba(26,26,26,0.8), rgba(26,26,26,0));
     }
     
     @media (prefers-color-scheme: dark) {
       :root:not([data-theme="light"]) .banner::after {
         background: linear-gradient(to top, rgba(26,26,26,0.8), rgba(26,26,26,0));
       }
     }

     .banner .overlay-text {
      position: absolute;
      bottom: 36%;
      left: 0;
      color: #0e0e0e;
      font-size: clamp(1.2rem, 4vw, 2.8rem);
      font-weight: 300;
      text-align: left;
      font-family: var(--chosen-font), serif;
      letter-spacing: .5px;
      z-index: 6;
      padding: 0 1rem;
      line-height: 1.1;
    }

    .banner .overlay-subtitle {
      position: absolute;
      bottom: calc(36% - clamp(0.6rem, 2vw, 1.1rem) * 1.2 - 0.1rem);
      left: 0;
      color: #0e0e0e;
      font-size: clamp(0.6rem, 2vw, 1.1rem);
      font-weight: 200;
      text-align: left;
      font-family: var(--chosen-font), serif;
      z-index: 6;
      margin: 0;
      padding: 0 1rem;
      line-height: 1.2;
    }
    
    /* Responsive font sizes for banner text */
    @media (max-width: 480px) {
      .banner .overlay-text {
        font-size: clamp(1rem, 5vw, 1.5rem);
      }
      .banner .overlay-subtitle {
        font-size: clamp(0.55rem, 2.5vw, 0.9rem);
      }
    }
    
    @media (min-width: 481px) and (max-width: 768px) {
      .banner .overlay-text {
        font-size: clamp(1.1rem, 4.5vw, 2rem);
      }
      .banner .overlay-subtitle {
        font-size: clamp(0.6rem, 2.2vw, 1rem);
      }
    }

    .intro{ padding: 1.5rem 0 0.5rem; text-align: center; }
    .intro .subtitle{ font-size: 1rem; font-style: italic; font-weight: 200; }

    .paper-card{ background: var(--card); padding: 1rem; display: flex; flex-direction: column; gap: .5rem; font-weight: 300; }
    .paper-card h3{ font-weight: 400; }
    .paper-card .figure-placeholder{ width: 100%; aspect-ratio: 1/1; background: var(--border); display: flex; align-items: center; justify-content: center; color: var(--muted); font-size: .9rem; font-style: italic; margin-bottom: .5rem; flex-shrink: 0; }

    .tags{ display: flex; flex-wrap: wrap; gap: .4rem; }
    .tag{ font-size: .8rem; padding: .2rem .5rem; border: 1px solid var(--border); border-radius: 999px; color: var(--muted); }
    .links-row{ display: flex; gap: .8rem; flex-wrap: wrap; }
    
    .abstract-toggle{ 
      background: var(--brand); 
      color: var(--bg); 
      border: none; 
      padding: .4rem .8rem; 
      border-radius: 4px; 
      font-size: .8rem; 
      cursor: pointer; 
      margin-top: .5rem;
      font-family: var(--chosen-font), serif;
    }
    .abstract-toggle:hover{ opacity: 0.8; }
    .abstract{ 
      margin-top: .5rem; 
      font-size: .85rem; 
      line-height: 1.4; 
      color: var(--muted);
    }

    section{ padding: 1rem 0; }
    
    section#papers{ padding-top: 0; }
    
    .tag-filter{
      padding: 0.5rem 0;
      margin-bottom: 2rem;
      position: sticky;
      top: 0;
      z-index: 6;
      background: var(--bg);
      transition: transform 0.3s ease-out, opacity 0.3s ease-out;
    }
    
    .tag-filter.sticky-active {
      backdrop-filter: saturate(180%) blur(8px);
      background: color-mix(in oklab, var(--bg) 95%, transparent);
      border-bottom: 1px solid var(--border);
    }
    
    .tag-filter-container{
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      justify-content: center;
      align-items: center;
    }
    
    .tag-filter-btn{
      background: var(--card);
      border: 1px solid var(--border);
      color: var(--text);
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-size: 0.85rem;
      font-family: var(--chosen-font), serif;
      cursor: pointer;
      transition: all 0.2s ease;
      white-space: nowrap;
    }
    
    .tag-filter-btn:hover{
      background: var(--brand);
      color: var(--bg);
      border-color: var(--brand);
    }
    
    .tag-filter-btn.active{
      background: var(--brand);
      color: var(--bg);
      border-color: var(--brand);
    }
    
    .grid{
      display: flex;
      gap: 1.2rem;
      justify-content: center;
      align-items: flex-start;
      flex-wrap: wrap;
    }
    
    .grid-column{
      display: flex;
      flex-direction: column;
      gap: 1.2rem;
      width: 280px;
      flex-shrink: 0;
    }
    
    /* Responsive column adjustments */
    @media (max-width: 920px) {
      .grid {
        flex-direction: column;
        align-items: center;
      }
      .grid-column {
        width: 100%;
        max-width: 400px;
      }
    }
    
    @media (min-width: 921px) and (max-width: 1200px) {
      .grid-column {
        width: 280px;
      }
    }
    
    .grid .paper-card{
      width: 100%;
    }
    .paper-card {
      min-height: 0;
    }

    .site-footer{ padding: 2.5rem 0; border-top: 1px solid var(--border); color: var(--muted); font-size: .9rem; font-style: italic; font-family: var(--chosen-font), serif; }
    .site-footer a{ color: var(--brand); }

    /* Thumbnail container */
    .thumb-container {
      width: 100%;
      aspect-ratio: 1/1;
      background-color: #fefefe;
      margin-bottom: .5rem;
      flex-shrink: 0;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    /* Thumbnail rule */
    .paper-card .thumb{
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    /* --- Line-art draw animation (banner.svg) --- */

    /* Animate ALL stroke-capable elements */
    .draw .svg-draw-stroke{
      stroke: var(--brand);
      stroke-width: 1.0;
      fill: none;
      stroke-linecap: round;
      stroke-linejoin: round;

      /* length normalization */
      stroke-dasharray: 1;
      stroke-dashoffset: 1;

      animation: banner-draw var(--draw-duration) cubic-bezier(.33,0,.17,1) forwards;
      animation-play-state: paused;
      will-change: stroke-dashoffset;
    }
    .draw.inview .svg-draw-stroke { animation-play-state: running; }

    @keyframes banner-draw { to { stroke-dashoffset: 0; } }

    @media (prefers-reduced-motion: reduce){
      .draw .svg-draw-stroke{ animation: none; stroke-dashoffset: 0; }
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="nav">
      <a href="/" class="brand">Semantic Control for Robotics<span class="dot">.</span></a>
      <nav class="links" aria-label="Primary">
        <a href="/">Home</a>
        <!-- <a href="/related-work/">Related Work</a> -->
        <a href="/people/">Contributors</a>
        <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
          <span id="theme-icon">‚òÄÔ∏è</span>
          <span id="theme-text">Light</span>
        </button>
      </nav>
    </div>
  </header>

  <main id="home" class="wrap">
    <section class="hero" aria-label="Site banner">
      <div class="banner" role="img" aria-label="Line art banner">
        <!-- SVG background and animation injected by JS -->
        <div class="overlay-text">semantic control for robotics</div>
        <div class="overlay-subtitle">perceive and act through robots' lenses</div>
      </div>
      <div class="intro"></div>
    </section>

    <section id="papers" aria-label="Papers">
      <div class="tag-filter">
        <div class="tag-filter-container">
          <button class="tag-filter-btn active" data-tag="all">All</button>
        </div>
      </div>
      <div id="papers-grid" class="grid" role="list"></div>
      <template id="paper-card-template">
        <article class="paper-card" role="listitem">
          <img class="thumb" alt="">
          <h3 class="title"></h3>
          <p class="meta"></p>
          <div class="tags"></div>
          <p class="links-row"></p>
          <button class="abstract-toggle" style="display: none;">Show Abstract</button>
          <div class="abstract" style="display: none;"></div>
        </article>
      </template>
    </section>
  </main>

  <footer class="site-footer">
    <div class="wrap">
      <p>¬© <span id="year"></span> Semantic Control for Robotics. The projects are supported by the European Union‚Äôs Horizon Europe research and innovation programme under the Marie Sk≈Çodowska-Curie grant agreement No. 101155035, by the <a href="https://www.robotics-institute-germany.de/">Robotics Institute Germany</a> under BMBF grant 16ME0997K, and by the Humboldt Professorship for Robotics and Artificial Intelligence.</p>
    </div>
  </footer>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>

  <script>
  (function initTheme() {
    // Set theme early to avoid flash of wrong theme
    const root = document.documentElement;
    
    // Get saved theme or detect system preference
    function getTheme() {
      const saved = localStorage.getItem('theme');
      if (saved) return saved;
      
      // Detect system preference
      if (window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches) {
        return 'light';
      }
      return 'dark';
    }
    
    // Initialize theme immediately
    const currentTheme = getTheme();
    root.setAttribute('data-theme', currentTheme);
    
    // Wait for DOM to be ready for button elements
    function setupThemeToggle() {
      const themeToggle = document.getElementById('theme-toggle');
      const themeIcon = document.getElementById('theme-icon');
      const themeText = document.getElementById('theme-text');
      
      if (!themeToggle || !themeIcon || !themeText) return;
      
      // Set theme (updates button)
      function setTheme(theme) {
        root.setAttribute('data-theme', theme);
        localStorage.setItem('theme', theme);
        
        // Update button to show what theme you'll switch TO (not current)
        if (theme === 'dark') {
          // Currently dark, button shows switch to light
          themeIcon.textContent = '‚òÄÔ∏è';
          themeText.textContent = 'Light';
        } else {
          // Currently light, button shows switch to dark
          themeIcon.textContent = 'üåô';
          themeText.textContent = 'Dark';
        }
      }
      
      // Set initial button state
      setTheme(currentTheme);
      
      // Toggle theme on button click
      themeToggle.addEventListener('click', () => {
        const current = root.getAttribute('data-theme');
        const newTheme = current === 'dark' ? 'light' : 'dark';
        setTheme(newTheme);
      });
    }
    
    // Setup toggle button when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', setupThemeToggle);
    } else {
      setupThemeToggle();
    }
    
    // Listen for system theme changes (only if no manual override)
    if (window.matchMedia) {
      window.matchMedia('(prefers-color-scheme: light)').addEventListener('change', (e) => {
        // Only update if user hasn't manually set a preference
        if (!localStorage.getItem('theme')) {
          root.setAttribute('data-theme', e.matches ? 'light' : 'dark');
          setupThemeToggle(); // Update button if it exists
        }
      });
    }
  })();
  </script>

  <script>
  (async function loadPapers(){
    const grid = document.getElementById('papers-grid');
    const tpl  = document.getElementById('paper-card-template');

    function addLinks(container, entries){
      const items = Object.entries(entries).filter(([,url]) => url && url !== '' && url !== '#');
      items.forEach(([label, url], i) => {
        const a = document.createElement('a');
        a.href = url;
        a.textContent = label;
        a.target = "_blank";
        a.rel = "noopener";
        container.appendChild(a);
        if (i < items.length - 1) container.append(" ¬∑ ");
      });
    }

    function filterPapers(selectedTag, projects, columns, allCards) {
      // Clear all columns
      columns.forEach(column => column.innerHTML = '');
      
      // Filter projects based on selected tag
      const filteredProjects = selectedTag === 'all' 
        ? projects 
        : projects.filter(p => p.tags && p.tags.includes(selectedTag));
      
      // Re-distribute filtered projects to columns
      filteredProjects.forEach((p, i) => {
        const columnIndex = i % columns.length;
        const card = allCards[p._file];
        if (card) {
          columns[columnIndex].appendChild(card);
        }
      });
    }

    async function loadOne(filename){
      const res = await fetch(`projects/${filename}`);
      if (!res.ok) throw new Error(`Failed to load ${filename}`);
      const data = await res.json();
      data._file = filename;
      return data;
    }

    try{
      const manifestRes = await fetch('projects/manifest.json');
      if (!manifestRes.ok) throw new Error('Failed to load projects/manifest.json');
      const files = await manifestRes.json();

      const projects = await Promise.all(files.map(loadOne));

      projects.sort((a, b) => {
        // First sort by order (if specified)
        if ((b.order || 0) !== (a.order || 0)) {
          return (b.order || 0) - (a.order || 0);
        }
        
        // Then sort by venue type with preferred order
        const getVenuePriority = (venue) => {
          if (!venue) return 999; // Unknown venues last
          const venueLower = venue.toLowerCase();
          
          // Define preferred venue order (lower number = higher priority)
          const venuePriorities = {
            // Top-tier journals
            'ijrr': 1,
            't-ro': 2,
            'ra-l': 3,
            'tac': 4,
            'automatica': 5,
            'ieee transactions': 6,
            'journal': 7,
            
            // Top-tier conferences
            'rss': 10,
            'icra': 11,
            'iros': 12,
            'corl': 13,
            'conference': 14,
            'symposium': 15,
            
            // Preprints
            'preprint': 20,
            'arxiv': 21,
            
            // Other venues
            'venue': 30
          };
          
          // Check for exact matches first
          for (const [key, priority] of Object.entries(venuePriorities)) {
            if (venueLower.includes(key)) {
              return priority;
            }
          }
          
          return 999; // Unknown venues last
        };
        
        const venuePriorityA = getVenuePriority(a.venue);
        const venuePriorityB = getVenuePriority(b.venue);
        if (venuePriorityA !== venuePriorityB) {
          return venuePriorityA - venuePriorityB;
        }
        
        // Then sort by year (newest first)
        if ((b.year || 0) !== (a.year || 0)) {
          return (b.year || 0) - (a.year || 0);
        }
        
        // Finally sort by title alphabetically
        return String(a.title).localeCompare(String(b.title));
      });

      // Collect all unique tags
      const allTags = new Set();
      projects.forEach(p => {
        if (p.tags && Array.isArray(p.tags)) {
          p.tags.forEach(tag => allTags.add(tag));
        }
      });

      // Create tag filter buttons
      const tagFilterContainer = document.querySelector('.tag-filter-container');
      const sortedTags = Array.from(allTags).sort();
      
      sortedTags.forEach(tag => {
        const button = document.createElement('button');
        button.className = 'tag-filter-btn';
        button.setAttribute('data-tag', tag);
        button.textContent = tag;
        tagFilterContainer.appendChild(button);
      });

      // Create columns based on screen width
      function getNumColumns() {
        const screenWidth = window.innerWidth;
        // Account for 3% padding on each side (6% total)
        const availableWidth = screenWidth * 0.94;
        const columnWidth = 280;
        const gap = 19.2; // 1.2rem ‚âà 19.2px
        
        if (screenWidth <= 920) return 1;      // Mobile: single column
        
        // Calculate how many columns can fit
        let cols = 2;
        if (availableWidth >= columnWidth * 2 + gap * 1) cols = 2;
        if (availableWidth >= columnWidth * 3 + gap * 2) cols = 3;
        if (availableWidth >= columnWidth * 4 + gap * 3) cols = 4;
        
        return cols;
      }
      
      const numColumns = getNumColumns();
      const columns = [];
      for (let i = 0; i < numColumns; i++) {
        const column = document.createElement('div');
        column.className = 'grid-column';
        grid.appendChild(column);
        columns.push(column);
      }

      // Store all cards for filtering
      const allCards = {};
      
      for (let i = 0; i < projects.length; i++){
        const p = projects[i];
        const node = tpl.content.cloneNode(true);
        const card = node.querySelector('.paper-card');
        
        // Add project ID for filtering
        card.setAttribute('data-project-id', p._file);
        
        // Store card for filtering
        allCards[p._file] = card;

        // Thumbnail or placeholder
        const img = node.querySelector('.thumb');
        if (p.thumb){
          // Wrap image in container for background styling
          img.src = p.thumb;
          img.alt = `${p.title} figure`;
          const thumbContainer = document.createElement('div');
          thumbContainer.className = 'thumb-container';
          img.parentNode.replaceChild(thumbContainer, img);
          thumbContainer.appendChild(img);
        } else {
          img.replaceWith(Object.assign(document.createElement('div'), {
            className: 'figure-placeholder',
            textContent: 'Figure Placeholder'
          }));
        }

        // Title
        node.querySelector('.title').textContent = p.title || 'Untitled';

        // Meta
        const yy = p.year ? String(p.year).slice(-2) : '';
        const authors = Array.isArray(p.authors) ? p.authors.join(', ') : (p.authors || '');
        node.querySelector('.meta').textContent =
          [p.venue, yy ? `'${yy}` : ''].filter(Boolean).join(' ') +
          (authors ? ` ¬∑ ${authors}` : '');

        // Tags
        const tagsEl = node.querySelector('.tags');
        (p.tags || []).forEach(tag => {
          const span = document.createElement('span');
          span.className = 'tag';
          span.textContent = tag;
          tagsEl.appendChild(span);
        });

        // Links
        const linksEl = node.querySelector('.links-row');
        const linkEntries = {
          pdf: p.pdf,
          website: p.website,
          code: p.code
        };
        
        // Add DOI if available and not placeholder
        if (p.doi && p.doi !== '#') {
          linkEntries.doi = `https://doi.org/${p.doi}`;
        }
        
        addLinks(linksEl, linkEntries);

        // Abstract toggle
        const abstractToggle = node.querySelector('.abstract-toggle');
        const abstractDiv = node.querySelector('.abstract');
        
        if (p.abstract) {
          abstractToggle.style.display = 'block';
          abstractDiv.textContent = p.abstract;
          
          abstractToggle.addEventListener('click', () => {
            const isVisible = abstractDiv.style.display !== 'none';
            if (isVisible) {
              abstractDiv.style.display = 'none';
              abstractToggle.textContent = 'Show Abstract';
            } else {
              abstractDiv.style.display = 'block';
              abstractToggle.textContent = 'Hide Abstract';
            }
          });
        }

        // Add to appropriate column (round-robin distribution)
        const columnIndex = i % numColumns;
        columns[columnIndex].appendChild(card);
      }

      // Add event listeners to filter buttons (after cards are created)
      const filterButtons = document.querySelectorAll('.tag-filter-btn');
      const tagFilter = document.querySelector('.tag-filter');
      const header = document.querySelector('.site-header');
      
      filterButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          // Remove active class from all buttons
          filterButtons.forEach(b => b.classList.remove('active'));
          // Add active class to clicked button
          btn.classList.add('active');
          
          const selectedTag = btn.getAttribute('data-tag');
          // Get current columns from DOM instead of using stored reference
          const currentColumns = Array.from(grid.querySelectorAll('.grid-column'));
          filterPapers(selectedTag, projects, currentColumns, allCards);
          
          // Scroll to show the first row of project cards below the categories bar
          setTimeout(() => {
            const headerHeight = header ? header.offsetHeight : 0;
            const tagFilterHeight = tagFilter ? tagFilter.offsetHeight : 0;
            const gridTop = grid.getBoundingClientRect().top + window.scrollY;
            const targetScroll = gridTop - headerHeight - tagFilterHeight - 20; // 20px extra spacing
            
            window.scrollTo({
              top: Math.max(0, targetScroll),
              behavior: 'smooth'
            });
          }, 50); // Small delay to ensure DOM updates are complete
        });
      });

      // Handle window resize to adjust columns
      let resizeTimeout;
      window.addEventListener('resize', () => {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(() => {
          const newNumColumns = getNumColumns();
          const currentColumns = grid.querySelectorAll('.grid-column');
          
          if (newNumColumns !== currentColumns.length) {
            // Clear existing columns
            grid.innerHTML = '';
            
            // Create new columns
            const newColumns = [];
            for (let i = 0; i < newNumColumns; i++) {
              const column = document.createElement('div');
              column.className = 'grid-column';
              grid.appendChild(column);
              newColumns.push(column);
            }
            
            // Re-distribute all cards to new columns
            const activeButton = document.querySelector('.tag-filter-btn.active');
            const selectedTag = activeButton ? activeButton.getAttribute('data-tag') : 'all';
            filterPapers(selectedTag, projects, newColumns, allCards);
          }
        }, 250); // Debounce resize events
      });
    } catch(err){
      console.error(err);
      grid.insertAdjacentHTML('beforebegin',
        `<p class="intro">Could not load projects. Please check <code>projects/manifest.json</code> and JSON files.</p>`
      );
    }
  })();
  </script>

  <!-- Inject banner.svg twice: once as background, once animated -->
  <script>
  (async function injectBannerSVG(){
    const banner = document.querySelector('.banner');
    if (!banner) return;

    try{
      const res = await fetch('assets/images/banner.svg');
      if (!res.ok) throw new Error('Failed to load assets/images/banner.svg');

      const svgText = await res.text();

      // Create a temporary SVG to determine which strokes to animate
      const tempWrap = document.createElement('div');
      tempWrap.innerHTML = svgText.trim();
      const tempSvg = tempWrap.querySelector('svg');
      if (!tempSvg) throw new Error('No <svg> root in banner.svg');
      
      // Select ALL stroke-capable elements to determine selection
      const allStrokesTemp = tempSvg.querySelectorAll('path, line, polyline, rect, circle, ellipse, polygon');
      
      // Filter out elements with data-no-anim
      const availableStrokes = Array.from(allStrokesTemp).filter(el => !el.hasAttribute('data-no-anim'));
      
      // Randomly select 30% of available strokes
      const totalStrokes = availableStrokes.length;
      const targetCount = Math.floor(totalStrokes * 0.30);
      const shuffled = availableStrokes.sort(() => Math.random() - 0.5);
      const selectedIndices = new Set();
      for (let i = 0; i < targetCount; i++) {
        // Store the index of selected strokes
        const index = Array.from(allStrokesTemp).indexOf(shuffled[i]);
        selectedIndices.add(index);
      }

      console.log(`Total strokes: ${totalStrokes}, Selected for animation: ${targetCount}`);

      // Create background SVG (static, no animation)
      const bgWrap = document.createElement('div');
      bgWrap.innerHTML = svgText.trim();
      const bgSvg = bgWrap.querySelector('svg');
      if (!bgSvg) throw new Error('No <svg> root in banner.svg');
      
      bgSvg.classList.add('banner-svg-bg');
      bgSvg.setAttribute('role','img');
      bgSvg.setAttribute('aria-label','Banner background');
      bgSvg.style.position = 'absolute';
      bgSvg.style.inset = '0';
      bgSvg.style.zIndex = '1';
      bgSvg.style.pointerEvents = 'none';
      
      // Show all strokes in background SVG (100% visible) with different color
      const bgStrokes = bgSvg.querySelectorAll('path, line, polyline, rect, circle, ellipse, polygon');
      bgStrokes.forEach((el) => {
        // Show all strokes with banner-stroke color (light gray/white, different from animated brand color)
        el.style.stroke = 'var(--banner-stroke)';
        el.style.fill = 'none';
      });

      // Create animated SVG (overlay)
      const animWrap = document.createElement('div');
      animWrap.innerHTML = svgText.trim();
      const animSvg = animWrap.querySelector('svg');
      if (!animSvg) throw new Error('No <svg> root in banner.svg');

      animSvg.classList.add('draw', 'banner-svg-animated');
      animSvg.setAttribute('role','img');
      animSvg.setAttribute('aria-label','Animated line art');
      animSvg.style.position = 'absolute';
      animSvg.style.inset = '0';
      animSvg.style.zIndex = '2';
      animSvg.style.pointerEvents = 'none';

      // Select strokes for animation (only the selected ones)
      const allStrokes = animSvg.querySelectorAll('path, line, polyline, rect, circle, ellipse, polygon');
      const selectedStrokes = Array.from(allStrokes).filter((el, index) => selectedIndices.has(index));

      // Read CSS var for stagger (fallback 160ms)
      const raw = getComputedStyle(document.documentElement)
        .getPropertyValue('--draw-stagger').trim() || '160ms';
      const step = parseFloat(raw) || 160;
      const unit = raw.replace(/[0-9.\s]/g,'') || 'ms';

      selectedStrokes.forEach((el, i) => {
        // Remove inline dash attrs that can override our CSS
        el.removeAttribute('stroke-dasharray');
        el.removeAttribute('stroke-dashoffset');

        // Normalize length to 1 so CSS 0..1 works consistently
        el.setAttribute('pathLength','1');

        // ensure it's styled/animated
        el.classList.add('svg-draw-stroke');
        
        // Set stroke color explicitly for animated strokes
        el.style.stroke = 'var(--brand)';
        el.style.fill = 'none';

        // Slow cascade; comment out next line to draw all at once
        el.style.animationDelay = (i * step) + unit;
      });
      
      // Hide all other strokes in the animated SVG that aren't being animated
      const nonAnimatedStrokes = Array.from(allStrokes).filter(el => !selectedStrokes.includes(el));
      nonAnimatedStrokes.forEach(el => {
        el.style.stroke = 'none';
        el.style.display = 'none';
      });

      // Insert background SVG first, then animated SVG
      banner.prepend(bgSvg);
      banner.prepend(animSvg);

      // Start animation when in view (runs once)
      const io = new IntersectionObserver(entries => {
        entries.forEach(e => {
          if (e.isIntersecting) {
            animSvg.classList.add('inview');
            io.unobserve(e.target);
          }
        });
      }, { threshold: 0.25 });
      io.observe(animSvg);

    } catch(err){
      console.error(err);
      // If SVG fails, show error message
      banner.style.backgroundColor = 'var(--bg)';
      banner.style.display = 'flex';
      banner.style.alignItems = 'center';
      banner.style.justifyContent = 'center';
      banner.textContent = 'Failed to load banner';
    }
  })();
  </script>

  <!-- Scroll behavior for banner and categories -->
  <script>
  (function handleScrollBehavior() {
    const banner = document.querySelector('.banner');
    const tagFilter = document.querySelector('.tag-filter');
    const hero = document.querySelector('.hero');
    const header = document.querySelector('.site-header');
    
    if (!banner || !tagFilter || !hero || !header) return;
    
    function updateScrollState() {
      const headerHeight = header.offsetHeight;
      
      // Get the tag filter's position relative to the viewport
      const tagFilterRect = tagFilter.getBoundingClientRect();
      const tagFilterTop = tagFilterRect.top;
      
      // When the top of the tag filter reaches just below the header (where it will stick)
      // Set the sticky position dynamically
      tagFilter.style.top = `${headerHeight}px`;
      
      if (tagFilterTop <= headerHeight) {
        banner.classList.add('scrolled-up');
        tagFilter.classList.add('sticky-active');
      } else {
        // When scrolling back up, restore banner and unstick categories
        banner.classList.remove('scrolled-up');
        if (tagFilterTop > headerHeight + 10) {
          tagFilter.classList.remove('sticky-active');
        }
      }
    }
    
    // Throttle scroll events for better performance
    let ticking = false;
    window.addEventListener('scroll', () => {
      if (!ticking) {
        window.requestAnimationFrame(() => {
          updateScrollState();
          ticking = false;
        });
        ticking = true;
      }
    });
    
    // Handle resize to recalculate positions
    window.addEventListener('resize', () => {
      updateScrollState();
    });
    
    // Initial state
    updateScrollState();
  })();
  </script>
</body>
</html>
